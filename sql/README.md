# Инструкция по запуску PostgreSQL через Docker

В данном проекте находятся:

- **Dockerfile** – файл с инструкциями для создания Docker-образа на основе официального PostgreSQL.
- **src** – папка, содержащая SQL-скрипты для создания базы данных, таблиц, вставки данных, выполнения запросов и генерации случайных данных. Все SQL-скрипты из этой папки нужно запустить вручную.

## Предварительные условия

- Убедитесь, что Docker установлен на вашем компьютере.  [Инструкция по установке Docker](https://docs.docker.com/get-docker/).
- Проверьте, что порт **5432** свободен или измените его в команде запуска.

## Шаг 1. Сборка Docker-образа

1. Откройте терминал в корневой директории проекта (там, где находится файл `Dockerfile`).
2. Выполните следующую команду для сборки Docker-образа:

```bash
docker build -t my_postgres .
```

Это создаст образ с именем my_postgres, в котором все SQL-скрипты из папки src будут скопированы в директорию /manual-sql/ внутри контейнера.

## Шаг 2. Запуск Docker-контейнера

1. Запустите контейнер с PostgreSQL, выполнив команду:

```bash
docker run -d --name postgres-container \
-e POSTGRES_USER=postgres \
-e POSTGRES_PASSWORD=password \
-p 5432:5432 \
my_postgres
```

- POSTGRES_USER=postgres — имя пользователя.
- POSTGRES_PASSWORD=password — пароль.
- Порт 5432 пробрасывается наружу.

2. Проверьте, что контейнер запущен:

```bash
docker ps
```

## Шаг 3. Подключение к базе данных

После запуска контейнера можно подключиться к стандартной БД postgres через командную строку с использованием psql:

```bash
docker exec -it postgres-container psql -U postgres
```

## Шаг 4. Проверка SQL-скриптов

1. Выполните команду, чтобы запустить скрипт для создания базы данных academy.

 ```bash
\i /manual-sql/create_database.sql
```

2. Выполните команду, чтобы запустить скрипт для создания таблиц в базе данных academy.

```bash
\i /manual-sql/create_tables.sql
```

Выполните команду \dt для просмотра списка таблиц.

3. Выполните команду, чтобы запустить скрипт для вставки записей в таблицы.

```bash
\i /manual-sql/insert_into_tables.sql
```

4. В файле querie_1.sql находится SQL-запрос, который возвращает студентов, не сдавших ни одного экзамена.

```bash
\i /manual-sql/querie_1.sql
```

5. В файле querie_2.sql находится SQL-запрос, который выводит список студентов с количеством сданных экзаменов (только для тех, кто сдавал экзамены).

```bash
\i /manual-sql/querie_2.sql
```

6. В файле querie_3.sql находится SQL-запрос, который выводит список курсов со средним баллом по экзаменам, отсортированного по убыванию.

```bash
\i /manual-sql/querie_3.sql
```

7. Для наполнения таблицы случайными данными, выполните скрипт generate_data.sql:

```bash
\i /manual-sql/generate_data.sql
```

## Шаг 6. Завершение работы

1. Для выхода из psql введите команду \q

2. Для остановки контейнера выполните:

```bash
docker stop postgres-container
```

3. Для удаления контейнера:

```bash
docker rm postgres-container
```

4. При необходимости удалите образ:

```bash
docker rmi my_postgres
```
